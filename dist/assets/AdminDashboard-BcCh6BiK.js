import{jsx as e,jsxs as a,Fragment as l}from"react/jsx-runtime";import n from"axios";import{useState as s,useEffect as r,useCallback as t,useRef as i}from"react";import c from"socket.io-client";import{u as o}from"../main.js";import{Chart as d,CategoryScale as m,LinearScale as h,PointElement as u,LineElement as p,BarElement as v,Title as N,Tooltip as g,Legend as b,ArcElement as y}from"chart.js";import{Line as f,Bar as C,Doughnut as k}from"react-chartjs-2";import"react-dom/client";import"react-router-dom";const w=({isOpen:l,onClose:r,onEmployeeCreated:t})=>{const[i,c]=s({username:"",email:"",password:"",name:"",percentage:""}),[o,d]=s(null),[m,h]=s(!1),[u,p]=s(""),v=e=>{const{name:a,value:l}=e.target;c(e=>({...e,[a]:l}))};return l?e("div",{className:"modal-overlay",children:a("div",{className:"modal-content",children:[a("div",{className:"modal-header",children:[e("h2",{children:"Créer un nouveau compte employé"}),e("button",{className:"close-button",onClick:r,children:"×"})]}),a("form",{onSubmit:async e=>{e.preventDefault(),h(!0),p("");try{const e=new FormData;e.append("username",i.username),e.append("email",i.email),e.append("password",i.password),e.append("name",i.name),e.append("percentage",i.percentage),o&&e.append("photo",o);const a=await n.post("http://localhost:3001/api/v1/auth/create-employee",e,{headers:{"Content-Type":"multipart/form-data"}});a.data.success&&(t(a.data.data.employee),r(),c({username:"",email:"",password:"",name:"",percentage:""}),d(null))}catch(a){p(a.response?.data?.message||"Erreur lors de la création de l'employé")}finally{h(!1)}},className:"employee-form",children:[u&&e("div",{className:"error-message",children:u}),a("div",{className:"form-group",children:[e("label",{htmlFor:"name",children:"Nom et Prénom *"}),e("input",{type:"text",id:"name",name:"name",value:i.name,onChange:v,required:!0,autoComplete:"name",placeholder:"Ex: Jean Dupont"})]}),a("div",{className:"form-group",children:[e("label",{htmlFor:"username",children:"Nom d'utilisateur *"}),e("input",{type:"text",id:"username",name:"username",value:i.username,onChange:v,required:!0,autoComplete:"username",placeholder:"Ex: jean_dupont"})]}),a("div",{className:"form-group",children:[e("label",{htmlFor:"email",children:"Email *"}),e("input",{type:"email",id:"email",name:"email",value:i.email,onChange:v,required:!0,autoComplete:"email",placeholder:"Ex: jean.dupont@email.com"})]}),a("div",{className:"form-group",children:[e("label",{htmlFor:"password",children:"Mot de passe *"}),e("input",{type:"password",id:"password",name:"password",value:i.password,onChange:v,required:!0,autoComplete:"new-password",placeholder:"Mot de passe sécurisé"})]}),a("div",{className:"form-group",children:[e("label",{htmlFor:"percentage",children:"Pourcentage de commission *"}),e("input",{type:"number",id:"percentage",name:"percentage",value:i.percentage,onChange:v,required:!0,min:"0",max:"100",step:"0.1",autoComplete:"off",placeholder:"Ex: 15.5"}),e("small",{className:"form-help",children:"Pourcentage calculé sur le Hors Tax des forfaits"})]}),a("div",{className:"form-group",children:[e("label",{htmlFor:"photo",children:"Photo de profil"}),e("input",{type:"file",id:"photo",name:"photo",onChange:e=>{const a=e.target.files[0];a&&d(a)},accept:"image/*"}),e("small",{className:"form-help",children:"Formats acceptés: JPG, PNG, GIF"})]}),a("div",{className:"form-actions",children:[e("button",{type:"button",onClick:r,className:"cancel-button",children:"Annuler"}),e("button",{type:"submit",disabled:m,className:"submit-button",children:m?"Création...":"Créer l'employé"})]})]})]})}):null},F=({employee:l,onCardClick:n})=>{const[r,t]=s(!1),i=e=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(e);return a("div",{className:"employee-card",onClick:()=>n(l),children:[e("div",{className:"employee-avatar",children:!r&&l.avatar_url?e("img",{src:`http://localhost:3001${l.avatar_url}`,alt:`${l.name} avatar`,onError:()=>{t(!0)}}):e("div",{className:"avatar-placeholder",children:l.name.charAt(0).toUpperCase()})}),a("div",{className:"employee-info",children:[e("h3",{className:"employee-name",children:l.name}),a("div",{className:"employee-stats",children:[a("div",{className:"stat-item",children:[e("span",{className:"stat-label",children:"Forfaits (mois)"}),e("span",{className:"stat-value",children:l.monthStats?.packageCount||0})]}),a("div",{className:"stat-item",children:[e("span",{className:"stat-label",children:"Total Clients (mois)"}),e("span",{className:"stat-value",children:l.monthStats?.totalClients||0})]}),a("div",{className:"stat-item",children:[e("span",{className:"stat-label",children:"Chiffre d'Affaires (mois)"}),e("span",{className:"stat-value revenue",children:i(l.monthStats?.totalRevenue||0)})]}),a("div",{className:"stat-item",children:[a("span",{className:"stat-label",children:["Commission (",l.percentage,"%)"]}),e("span",{className:"stat-value commission",children:i(l.monthStats?.commission||0)})]}),l.selectedPackage&&a("div",{className:"stat-item",children:[e("span",{className:"stat-label",children:"Forfait sélectionné"}),e("span",{className:"stat-value package-name",children:l.selectedPackage.name})]})]})]}),e("div",{className:"card-indicator",children:e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e("path",{d:"M9 5L16 12L9 19",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]})},x=({isOpen:l,onClose:t,employee:i})=>{const[c,o]=s("today"),[d,m]=s(null),[h,u]=s(!1);r(()=>{l&&i&&p()},[l,i,c]);const p=async()=>{if(i){u(!0);try{const e=await n.get(`http://localhost:3001/api/v1/employees/${i.id}/detailed-stats?period=${c}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});e.data.success?m(e.data.data):m(null)}catch(e){m(null)}finally{u(!1)}}},v=e=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(e);return l&&i?e("div",{className:"modal-overlay",children:a("div",{className:"modal-content large-modal",children:[a("div",{className:"modal-header",children:[a("div",{className:"employee-header-info",children:[e("div",{className:"employee-avatar",children:i.avatar_url?e("img",{src:`http://localhost:3001${i.avatar_url}`,alt:`${i.name} avatar`}):e("div",{className:"avatar-placeholder",children:i.name.charAt(0).toUpperCase()})}),a("div",{children:[e("h2",{children:i.name}),a("p",{className:"employee-percentage",children:["Commission: ",i.percentage,"% sur HT"]})]})]}),e("button",{className:"close-button",onClick:t,children:"×"})]}),a("div",{className:"modal-body",children:[a("div",{className:"tabs",children:[e("button",{className:"tab-button "+("today"===c?"active":""),onClick:()=>o("today"),children:"Aujourd'hui"}),e("button",{className:"tab-button "+("week"===c?"active":""),onClick:()=>o("week"),children:"Cette semaine"}),e("button",{className:"tab-button "+("month"===c?"active":""),onClick:()=>o("month"),children:"Ce mois"}),e("button",{className:"tab-button "+("year"===c?"active":""),onClick:()=>o("year"),children:"Cette année"})]}),h?e("div",{className:"loading",children:"Chargement des données..."}):d?a("div",{className:"stats-content",children:[a("div",{className:"stats-summary",children:[a("div",{className:"summary-card",children:[e("h3",{children:"Forfaits réalisés"}),e("p",{className:"summary-value",children:d.totalPackages})]}),a("div",{className:"summary-card",children:[e("h3",{children:"CA généré (HT)"}),e("p",{className:"summary-value",children:v(d.totalRevenue)})]}),a("div",{className:"summary-card",children:[e("h3",{children:"Commission totale"}),e("p",{className:"summary-value commission",children:v(d.totalCommission)})]})]}),a("div",{className:"packages-list",children:[e("h3",{children:"Détail des forfaits"}),a("div",{className:"packages-table",children:[a("div",{className:"table-header",children:[e("span",{children:"Date"}),e("span",{children:"Client"}),e("span",{children:"Forfait"}),e("span",{children:"Prix HT"}),e("span",{children:"Commission"})]}),d.packages.map(l=>{return a("div",{className:"table-row",children:[e("span",{children:(n=l.date,new Date(n).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}))}),e("span",{children:l.client_name}),e("span",{children:l.package_name}),e("span",{children:v(l.ht_price)}),e("span",{className:"commission",children:v(l.commission)})]},l.id);var n})]})]})]}):e("div",{className:"no-data",children:"Aucune donnée disponible"})]})]})}):null},E=({isOpen:l,onClose:i,onEmployeeUpdated:c})=>{const[o,d]=s([]),[m,h]=s(!1),[u,p]=s(""),[v,N]=s(null),[g,b]=s({username:"",email:"",name:"",percentage:"",password:""}),y="http://localhost:3001/api/v1";r(()=>{l&&f()},[l]);const f=t(async()=>{h(!0);try{const e=await n.get(`${y}/employees`);d(e.data.data||[])}catch(e){p("Erreur lors du chargement des employés")}finally{h(!1)}},[y]),C=e=>{const{name:a,value:l}=e.target;b(e=>({...e,[a]:l}))},k=()=>{b({username:"",email:"",name:"",percentage:"",password:""})};return l?e("div",{className:"modal-overlay",children:a("div",{className:"modal-content large-modal",children:[a("div",{className:"modal-header",children:[e("h2",{children:"Gestion des comptes employés"}),e("button",{className:"close-button",onClick:i,children:"×"})]}),a("div",{className:"modal-body",children:[u&&e("div",{className:"error-message",children:u}),e("div",{className:"employee-summary",children:a("div",{className:"summary-card",children:[e("h3",{children:"Total employés"}),e("p",{className:"total-count",children:o.length})]})}),v&&a("form",{onSubmit:async e=>{e.preventDefault(),h(!0),p("");try{const e={...g,percentage:parseFloat(g.percentage)||0};e.password||delete e.password,v&&await n.put(`${y}/employees/${v.id}`,e),await f(),c(),k(),N(null)}catch(a){p(a.response?.data?.message||"Erreur lors de la sauvegarde")}finally{h(!1)}},className:"employee-form",children:[e("h3",{children:"Modifier le compte employé"}),a("div",{className:"form-row",children:[a("div",{className:"form-group",children:[e("label",{htmlFor:"username",children:"Nom d'utilisateur *"}),e("input",{type:"text",id:"username",name:"username",value:g.username,onChange:C,required:!0,autoComplete:"username",placeholder:"nom_utilisateur"})]}),a("div",{className:"form-group",children:[e("label",{htmlFor:"email",children:"Email *"}),e("input",{type:"email",id:"email",name:"email",value:g.email,onChange:C,required:!0,autoComplete:"email",placeholder:"email@exemple.com"})]})]}),a("div",{className:"form-row",children:[a("div",{className:"form-group",children:[e("label",{htmlFor:"name",children:"Nom complet *"}),e("input",{type:"text",id:"name",name:"name",value:g.name,onChange:C,required:!0,autoComplete:"name",placeholder:"Prénom Nom"})]}),a("div",{className:"form-group",children:[e("label",{htmlFor:"percentage",children:"Pourcentage (%)"}),e("input",{type:"number",id:"percentage",name:"percentage",value:g.percentage,onChange:C,min:"0",max:"100",step:"0.1",autoComplete:"off",placeholder:"Ex: 10.5"})]})]}),e("div",{className:"form-row",children:a("div",{className:"form-group",children:[e("label",{htmlFor:"password",children:"Nouveau mot de passe (laisser vide pour garder l'actuel)"}),e("input",{type:"password",id:"password",name:"password",value:g.password,onChange:C,autoComplete:"new-password",placeholder:"Nouveau mot de passe"})]})}),a("div",{className:"form-actions",children:[e("button",{type:"button",onClick:()=>{k(),N(null)},className:"cancel-button",children:"Annuler"}),e("button",{type:"submit",disabled:m,className:"submit-button",children:m?"Sauvegarde...":"Modifier"})]})]}),a("div",{className:"employees-list",children:[e("h3",{children:"Comptes employés"}),m&&!v?e("div",{className:"loading",children:"Chargement des employés..."}):o.length>0?a("div",{className:"employees-table",children:[a("div",{className:"table-header",children:[e("span",{children:"Nom"}),e("span",{children:"Utilisateur"}),e("span",{children:"Email"}),e("span",{children:"Pourcentage"}),e("span",{children:"Date création"}),e("span",{children:"Actions"})]}),o.map(l=>{return a("div",{className:"table-row",children:[e("span",{className:"employee-name",children:l.name}),e("span",{children:l.user?.username}),e("span",{children:l.user?.email}),e("span",{children:l.percentage?`${l.percentage}%`:"N/A"}),e("span",{children:(s=l.created_at,new Date(s).toLocaleDateString("fr-FR"))}),a("span",{className:"actions",children:[e("button",{onClick:()=>(e=>{N(e),b({username:e.user?.username||"",email:e.user?.email||"",name:e.name||"",percentage:e.percentage?.toString()||"",password:""})})(l),className:"edit-button",children:"✏️"}),e("button",{onClick:()=>(async e=>{if(window.confirm(`Êtes-vous sûr de vouloir supprimer le compte "${e.name}" ? Cette action est irréversible.`)){h(!0);try{await n.delete(`${y}/employees/${e.id}`),await f(),c()}catch(a){p("Erreur lors de la suppression")}finally{h(!1)}}})(l),className:"delete-button",children:"🗑️"})]})]},l.id);var s})]}):e("div",{className:"no-data",children:"Aucun employé enregistré"})]})]})]})}):null},D=({isOpen:l,onClose:i})=>{const[c,o]=s([]),[d,m]=s(!1),[h,u]=s(""),[p,v]=s(!1),[N,g]=s(null),[b,y]=s({description:"",amount:"",date:(new Date).toISOString().split("T")[0],category:""}),f="http://localhost:3001/api/v1";r(()=>{l&&C()},[l]);const C=t(async()=>{m(!0);try{const e=await n.get(`${f}/dashboard/expenses`);o(e.data.data||[])}catch(e){u("Erreur lors du chargement des charges")}finally{m(!1)}},[f]),k=e=>{const{name:a,value:l}=e.target;y(e=>({...e,[a]:l}))},w=()=>{y({description:"",amount:"",date:(new Date).toISOString().split("T")[0],category:""})},F=e=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(e);return l?e("div",{className:"modal-overlay",children:a("div",{className:"modal-content large-modal",children:[a("div",{className:"modal-header",children:[e("h2",{children:"Gestion des charges"}),e("button",{className:"close-button",onClick:i,children:"×"})]}),a("div",{className:"modal-body",children:[h&&e("div",{className:"error-message",children:h}),e("div",{className:"expense-summary",children:a("div",{className:"summary-card",children:[e("h3",{children:"Total des charges"}),e("p",{className:"total-amount",children:F(c.reduce((e,a)=>e+parseFloat(a.amount),0))})]})}),e("div",{className:"modal-actions",children:e("button",{onClick:()=>{w(),g(null),v(!p)},className:"action-button primary",children:p?"Annuler":"+ Nouvelle charge"})}),p&&a("form",{onSubmit:async e=>{e.preventDefault(),m(!0),u("");try{const e={...b,amount:parseFloat(b.amount)};N?await n.put(`${f}/dashboard/expenses/${N.id}`,e):await n.post(`${f}/dashboard/expenses`,e),await C(),w(),v(!1),g(null)}catch(a){u(a.response?.data?.message||"Erreur lors de la sauvegarde")}finally{m(!1)}},className:"expense-form",children:[e("h3",{children:N?"Modifier la charge":"Enregistrer une nouvelle charge"}),a("div",{className:"form-row",children:[a("div",{className:"form-group",children:[e("label",{htmlFor:"description",children:"Description *"}),e("input",{type:"text",id:"description",name:"description",value:b.description,onChange:k,required:!0,autoComplete:"off",placeholder:"Ex: Fournitures de coiffure"})]}),a("div",{className:"form-group",children:[e("label",{htmlFor:"amount",children:"Montant (€) *"}),e("input",{type:"number",id:"amount",name:"amount",value:b.amount,onChange:k,required:!0,min:"0",step:"0.01",autoComplete:"off",placeholder:"Ex: 150.00"})]})]}),a("div",{className:"form-row",children:[a("div",{className:"form-group",children:[e("label",{htmlFor:"date",children:"Date *"}),e("input",{type:"date",id:"date",name:"date",value:b.date,onChange:k,required:!0,autoComplete:"off"})]}),a("div",{className:"form-group",children:[e("label",{htmlFor:"category",children:"Catégorie"}),a("select",{id:"category",name:"category",value:b.category,onChange:k,autoComplete:"off",children:[e("option",{value:"",children:"Sélectionner une catégorie"}),e("option",{value:"fournitures",children:"Fournitures"}),e("option",{value:"loyer",children:"Loyer"}),e("option",{value:"utilities",children:"Utilitaires"}),e("option",{value:"marketing",children:"Marketing"}),e("option",{value:"autres",children:"Autres"})]})]})]}),a("div",{className:"form-actions",children:[e("button",{type:"button",onClick:()=>v(!1),className:"cancel-button",children:"Annuler"}),e("button",{type:"submit",disabled:d,className:"submit-button",children:d?"Sauvegarde...":N?"Modifier":"Enregistrer"})]})]}),a("div",{className:"expenses-list",children:[e("h3",{children:"Charges enregistrées"}),d&&!p?e("div",{className:"loading",children:"Chargement des charges..."}):c.length>0?a("div",{className:"expenses-table",children:[a("div",{className:"table-header",children:[e("span",{children:"Description"}),e("span",{children:"Montant"}),e("span",{children:"Date"}),e("span",{children:"Catégorie"}),e("span",{children:"Actions"})]}),c.map(l=>{return a("div",{className:"table-row",children:[e("span",{className:"expense-description",children:l.description}),e("span",{children:F(l.amount)}),e("span",{children:(s=l.date,new Date(s).toLocaleDateString("fr-FR"))}),e("span",{className:"category",children:l.category||"Non catégorisé"}),a("span",{className:"actions",children:[e("button",{onClick:()=>(e=>{g(e),y({description:e.description,amount:e.amount.toString(),date:e.date,category:e.category||""}),v(!0)})(l),className:"edit-button",children:"✏️"}),e("button",{onClick:()=>(async e=>{if(window.confirm(`Êtes-vous sûr de vouloir supprimer cette charge "${e.description}" ?`)){m(!0);try{await n.delete(`${f}/dashboard/expenses/${e.id}`),await C()}catch(a){u("Erreur lors de la suppression")}finally{m(!1)}}})(l),className:"delete-button",children:"🗑️"})]})]},l.id);var s})]}):e("div",{className:"no-data",children:"Aucune charge enregistrée pour le moment"})]})]})]})}):null},A=({isOpen:l,onClose:t})=>{const[i,c]=s([]),[o,d]=s(!1),[m,h]=s(""),[u,p]=s(!1),[v,N]=s(null),[g,b]=s({name:"",price:"",description:"",duration_minutes:"",is_active:!0}),y="http://localhost:3001/api/v1";r(()=>{l&&f()},[l]);const f=async()=>{d(!0);try{const e=await n.get(`${y}/packages`);c(e.data.data||[])}catch(e){h("Erreur lors du chargement des forfaits")}finally{d(!1)}},C=e=>{const{name:a,value:l,type:n,checked:s}=e.target;b(e=>({...e,[a]:"checkbox"===n?s:l}))},k=()=>{b({name:"",price:"",description:"",duration_minutes:"",is_active:!0})};return l?e("div",{className:"modal-overlay",children:a("div",{className:"modal-content large-modal",children:[a("div",{className:"modal-header",children:[e("h2",{children:"Gestion des forfaits"}),e("button",{className:"close-button",onClick:t,children:"×"})]}),a("div",{className:"modal-body",children:[m&&e("div",{className:"error-message",children:m}),e("div",{className:"modal-actions",children:e("button",{onClick:()=>{k(),N(null),p(!u)},className:"action-button primary",children:u?"Annuler":"+ Nouveau forfait"})}),u&&a("form",{onSubmit:async e=>{e.preventDefault(),d(!0),h("");try{const e={...g,price:parseFloat(g.price),duration_minutes:parseInt(g.duration_minutes)};v?await n.put(`${y}/packages/${v.id}`,e):await n.post(`${y}/packages`,e),await f(),k(),p(!1),N(null)}catch(a){h(a.response?.data?.message||"Erreur lors de la sauvegarde")}finally{d(!1)}},className:"package-form",children:[e("h3",{children:v?"Modifier le forfait":"Créer un nouveau forfait"}),a("div",{className:"form-row",children:[a("div",{className:"form-group",children:[e("label",{htmlFor:"name",children:"Nom du forfait *"}),e("input",{type:"text",id:"name",name:"name",value:g.name,onChange:C,required:!0,autoComplete:"off",placeholder:"Ex: Coupe + brushing"})]}),a("div",{className:"form-group",children:[e("label",{htmlFor:"price",children:"Prix HT (€) *"}),e("input",{type:"number",id:"price",name:"price",value:g.price,onChange:C,required:!0,min:"0",step:"0.01",autoComplete:"off",placeholder:"Ex: 45.00"})]})]}),a("div",{className:"form-row",children:[a("div",{className:"form-group",children:[e("label",{htmlFor:"duration_minutes",children:"Durée (minutes) *"}),e("input",{type:"number",id:"duration_minutes",name:"duration_minutes",value:g.duration_minutes,onChange:C,required:!0,min:"1",autoComplete:"off",placeholder:"Ex: 60"})]}),e("div",{className:"form-group",children:a("label",{className:"checkbox-label",children:[e("input",{type:"checkbox",name:"is_active",checked:g.is_active,onChange:C}),"Forfait actif"]})})]}),a("div",{className:"form-group",children:[e("label",{htmlFor:"description",children:"Description"}),e("textarea",{id:"description",name:"description",value:g.description,onChange:C,rows:"3",autoComplete:"off",placeholder:"Description optionnelle du forfait"})]}),a("div",{className:"form-actions",children:[e("button",{type:"button",onClick:()=>p(!1),className:"cancel-button",children:"Annuler"}),e("button",{type:"submit",disabled:o,className:"submit-button",children:o?"Sauvegarde...":v?"Modifier":"Créer"})]})]}),a("div",{className:"packages-list",children:[e("h3",{children:"Forfaits existants"}),o&&!u?e("div",{className:"loading",children:"Chargement des forfaits..."}):i.length>0?a("div",{className:"packages-table",children:[a("div",{className:"table-header",children:[e("span",{children:"Nom"}),e("span",{children:"Prix HT"}),e("span",{children:"Durée"}),e("span",{children:"Statut"}),e("span",{children:"Actions"})]}),i.map(l=>{return a("div",{className:"table-row",children:[e("span",{className:"package-name",children:l.name}),e("span",{children:(s=l.price,new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(s))}),a("span",{children:[l.duration_minutes," min"]}),e("span",{children:e("button",{onClick:()=>(async e=>{d(!0);try{await n.put(`${y}/packages/${e.id}`,{...e,is_active:!e.is_active}),await f()}catch(a){h("Erreur lors de la modification du statut")}finally{d(!1)}})(l),className:"status-button "+(l.is_active?"active":"inactive"),children:l.is_active?"Actif":"Inactif"})}),a("span",{className:"actions",children:[e("button",{onClick:()=>(e=>{N(e),b({name:e.name,price:e.price.toString(),description:e.description||"",duration_minutes:e.duration_minutes.toString(),is_active:e.is_active}),p(!0)})(l),className:"edit-button",children:"✏️"}),e("button",{onClick:()=>(async e=>{if(window.confirm(`Êtes-vous sûr de vouloir supprimer le forfait "${e.name}" ?`)){d(!0);try{await n.delete(`${y}/packages/${e.id}`),await f()}catch(a){h("Erreur lors de la suppression")}finally{d(!1)}}})(l),className:"delete-button",children:"🗑️"})]})]},l.id);var s})]}):e("div",{className:"no-data",children:"Aucun forfait créé pour le moment"})]})]})]})}):null};d.register(m,h,u,p,v,N,g,b,y);const $=({isOpen:i,onClose:c})=>{const[o,d]=s(null),[m,h]=s(!1),[u,p]=s(""),[v,N]=s("month"),[g,b]=s("revenue"),y="http://localhost:3001/api/v1";r(()=>{i&&w()},[i,v]);const w=t(async()=>{h(!0);try{const e=await n.get(`${y}/dashboard/analytics?period=${v}`);d(e.data.data)}catch(e){p("Erreur lors du chargement des statistiques")}finally{h(!1)}},[y,v]),F=e=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(e||0),x=e=>new Date(e).toLocaleDateString("fr-FR",{month:"short",year:"numeric"}),E=()=>o?.monthlyData?{labels:o.monthlyData.map(e=>x(e.month)),datasets:[{label:"Chiffre d'affaires",data:o.monthlyData.map(e=>e.revenue),borderColor:"#007bff",backgroundColor:"rgba(0, 123, 255, 0.1)",tension:.4},{label:"Charges",data:o.monthlyData.map(e=>e.expenses),borderColor:"#dc3545",backgroundColor:"rgba(220, 53, 69, 0.1)",tension:.4},{label:"Bénéfice",data:o.monthlyData.map(e=>e.profit),borderColor:"#28a745",backgroundColor:"rgba(40, 167, 69, 0.1)",tension:.4}]}:null,D=()=>o?.monthlyData?{labels:o.monthlyData.map(e=>x(e.month)),datasets:[{label:"Ventes",data:o.monthlyData.map(e=>e.sales),backgroundColor:"#007bff"},{label:"Recettes",data:o.monthlyData.map(e=>e.receipts),backgroundColor:"#28a745"}]}:null,A=()=>o?.packageStats?{labels:o.packageStats.map(e=>e.name),datasets:[{data:o.packageStats.map(e=>e.count),backgroundColor:["#007bff","#28a745","#ffc107","#dc3545","#6f42c1","#e83e8c","#fd7e14"]}]}:null,$=()=>o?.employeeStats?{labels:o.employeeStats.map(e=>e.name),datasets:[{label:"Chiffre d'affaires généré",data:o.employeeStats.map(e=>e.revenue),backgroundColor:"#007bff"}]}:null;return i?e("div",{className:"modal-overlay",children:a("div",{className:"modal-content large-modal",children:[a("div",{className:"modal-header",children:[e("h2",{children:"Statistiques et Analyses"}),e("button",{className:"close-button",onClick:c,children:"×"})]}),a("div",{className:"modal-body",children:[u&&e("div",{className:"error-message",children:u}),e("div",{className:"stats-controls",children:a("div",{className:"time-range-selector",children:[e("label",{children:"Période:"}),a("select",{value:v,onChange:e=>N(e.target.value),children:[e("option",{value:"week",children:"Cette semaine"}),e("option",{value:"month",children:"Ce mois"}),e("option",{value:"quarter",children:"Ce trimestre"}),e("option",{value:"year",children:"Cette année"})]})]})}),m?e("div",{className:"loading",children:"Chargement des statistiques..."}):o?a(l,{children:[e("div",{className:"stats-summary",children:a("div",{className:"summary-grid",children:[a("div",{className:"summary-card",children:[e("h4",{children:"Chiffre d'affaires total"}),e("p",{className:"summary-value",children:F(o.totalRevenue)})]}),a("div",{className:"summary-card",children:[e("h4",{children:"Charges totales"}),e("p",{className:"summary-value",children:F(o.totalExpenses)})]}),a("div",{className:"summary-card",children:[e("h4",{children:"Bénéfice net"}),e("p",{className:"summary-value "+(o.totalProfit>=0?"positive":"negative"),children:F(o.totalProfit)})]}),a("div",{className:"summary-card",children:[e("h4",{children:"Marge bénéficiaire"}),a("p",{className:"summary-value",children:[o.profitMargin,"%"]})]})]})}),a("div",{className:"stats-tabs",children:[e("button",{className:"tab-button "+("revenue"===g?"active":""),onClick:()=>b("revenue"),children:"Évolution CA"}),e("button",{className:"tab-button "+("sales"===g?"active":""),onClick:()=>b("sales"),children:"Ventes & Recettes"}),e("button",{className:"tab-button "+("packages"===g?"active":""),onClick:()=>b("packages"),children:"Popularité forfaits"}),e("button",{className:"tab-button "+("employees"===g?"active":""),onClick:()=>b("employees"),children:"Performance employés"})]}),a("div",{className:"chart-container",children:["revenue"===g&&E()&&a("div",{className:"chart-wrapper",children:[e("h3",{children:"Évolution du Chiffre d'Affaires"}),e(f,{data:E(),options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return F(e)}}}}}})]}),"sales"===g&&D()&&a("div",{className:"chart-wrapper",children:[e("h3",{children:"Ventes et Recettes par période"}),e(C,{data:D(),options:{responsive:!0,plugins:{legend:{position:"top"}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return F(e)}}}}}})]}),"packages"===g&&A()&&a("div",{className:"chart-wrapper",children:[e("h3",{children:"Popularité des forfaits"}),e(k,{data:A(),options:{responsive:!0,plugins:{legend:{position:"right"}}}})]}),"employees"===g&&$()&&a("div",{className:"chart-wrapper",children:[e("h3",{children:"Performance des employés"}),e(C,{data:$(),options:{responsive:!0,plugins:{legend:{position:"top"}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return F(e)}}}}}})]})]})]}):e("div",{className:"no-data",children:"Aucune donnée statistique disponible"})]})]})}):null},S=({isOpen:l,onClose:t})=>{const[i,c]=s(null),[o,d]=s(!1),[m,h]=s(""),[u,p]=s((new Date).getFullYear());r(()=>{l&&(async e=>{d(!0),h("");try{const a=await n.get(`http://localhost:3001/api/v1/dashboard/reports/annual-profit?year=${e}`);c(a.data.data)}catch(a){h("Erreur lors du chargement des données")}finally{d(!1)}})(u)},[l,u]);return l?e("div",{className:"modal-overlay",children:a("div",{className:"modal-content annual-profit-modal",children:[a("div",{className:"modal-header",children:[e("h2",{children:"Bénéfices Annuels"}),e("button",{onClick:t,className:"close-button",children:"×"})]}),a("div",{className:"modal-body",children:[a("div",{className:"year-selector",children:[e("label",{htmlFor:"year-select",children:"Année:"}),e("select",{id:"year-select",value:u,onChange:e=>{return a=parseInt(e.target.value),void p(a);var a},children:(()=>{const e=(new Date).getFullYear(),a=[];for(let l=e;l>=e-5;l--)a.push(l);return a})().map(a=>e("option",{value:a,children:a},a))})]}),o&&a("div",{className:"loading-container",children:[e("div",{className:"loading-spinner"}),e("p",{children:"Chargement des données..."})]}),m&&e("div",{className:"error-message",children:m}),i&&!o&&a("div",{className:"annual-profit-content",children:[a("div",{className:"annual-summary",children:[a("h3",{children:["Résumé Annuel ",i.year]}),a("div",{className:"summary-cards",children:[a("div",{className:"summary-card",children:[e("h4",{children:"Chiffre d'Affaires Total"}),a("p",{className:"summary-value",children:["€",i.annualTotals.totalTurnover.toFixed(2)]})]}),a("div",{className:"summary-card",children:[e("h4",{children:"Charges Totales"}),a("p",{className:"summary-value",children:["€",i.annualTotals.totalExpenses.toFixed(2)]})]}),a("div",{className:"summary-card",children:[e("h4",{children:"Commissions Totales"}),a("p",{className:"summary-value",children:["€",i.annualTotals.totalCommissions.toFixed(2)]})]}),a("div",{className:"summary-card profit-card",children:[e("h4",{children:"Bénéfice Net Total"}),a("p",{className:"summary-value",children:["€",i.annualTotals.totalProfit.toFixed(2)]})]})]})]}),a("div",{className:"monthly-breakdown",children:[e("h3",{children:"Détail Mensuel"}),a("div",{className:"monthly-table",children:[a("div",{className:"table-header",children:[e("div",{className:"table-cell",children:"Mois"}),e("div",{className:"table-cell",children:"CA (€)"}),e("div",{className:"table-cell",children:"Charges (€)"}),e("div",{className:"table-cell",children:"Commissions (€)"}),e("div",{className:"table-cell",children:"Bénéfice (€)"})]}),i.monthlyProfits.map((l,n)=>a("div",{className:"table-row",children:[e("div",{className:"table-cell month-cell",children:l.month}),e("div",{className:"table-cell",children:l.turnover.toFixed(2)}),e("div",{className:"table-cell",children:l.expenses.toFixed(2)}),e("div",{className:"table-cell",children:l.commissions.toFixed(2)}),e("div",{className:"table-cell profit-cell "+(l.profit>=0?"positive":"negative"),children:l.profit.toFixed(2)})]},n))]})]})]})]})]})}):null},_=()=>{const{user:l,logout:d}=o(),[m,h]=s(null),[u,p]=s([]),[v,N]=s(!0),[g,b]=s(""),[y,f]=s(!1),[C,k]=s(null),[_,P]=s(!1),[q,R]=s(!1),[T,M]=s(!1),[O,L]=s(!1),[I,U]=s(!1),[j,B]=s(!1),[G,H]=s(!1),V=i(null),Z="http://localhost:3001/api/v1",J=i(null),W=t(async()=>{try{const e=await n.get(`${Z}/dashboard`);h(e.data);const a=await n.get(`${Z}/employees`);p(a.data.data||[])}catch(e){b("Failed to load dashboard data")}finally{N(!1)}},[Z]);r(()=>{if(W(),l&&l.id){const e="http://localhost:3001";return J.current=c(e),J.current.emit("join-dashboard",l.id),J.current.on("dashboard-data-updated",()=>{W()}),()=>{J.current&&J.current.disconnect()}}},[l,W]),r(()=>{const e=e=>{V.current&&!V.current.contains(e.target)&&H(!1)};return G&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[G]);const Y=()=>{d()},z=e=>{switch(H(!1),e){case"dashboard":break;case"createEmployee":f(!0);break;case"manageEmployees":U(!0);break;case"managePackages":R(!0);break;case"expenses":M(!0);break;case"statistics":L(!0);break;case"annualProfit":B(!0)}},K=e=>{k(e),P(!0)};return a("div",v?{className:"loading-container",children:[e("div",{className:"loading-spinner"}),e("p",{children:"Loading dashboard..."})]}:g?{className:"dashboard-container",children:[e("div",{className:"error-message",children:g}),e("button",{onClick:Y,className:"logout-button",children:"Logout"})]}:{className:"dashboard-container",children:[a("header",{className:"dashboard-header",children:[e("h1",{children:"Admin Dashboard"}),a("div",{className:"user-info",children:[a("span",{children:["Welcome, ",l?.name||l?.email]}),e("button",{onClick:()=>{H(!G)},className:"hamburger-btn",children:"☰"})]})]}),G&&a("div",{className:"hamburger-menu",ref:V,children:[e("button",{onClick:()=>z("dashboard"),className:"menu-item",children:"Dashboard Admin"}),e("button",{onClick:()=>z("createEmployee"),className:"menu-item",children:"Créer Employé"}),e("button",{onClick:()=>z("manageEmployees"),className:"menu-item",children:"Gestion des Employés"}),e("button",{onClick:()=>z("managePackages"),className:"menu-item",children:"Gestion des Forfaits"}),e("button",{onClick:()=>z("expenses"),className:"menu-item",children:"Charges"}),e("button",{onClick:()=>z("statistics"),className:"menu-item",children:"Statistiques"}),e("button",{onClick:()=>z("annualProfit"),className:"menu-item",children:"Bénéfices Annuels"}),e("div",{className:"menu-divider"}),e("button",{onClick:Y,className:"menu-item logout-item",children:"Déconnexion"})]}),a("div",{className:"dashboard-content",children:[m&&m.data?a("div",{className:"dashboard-stats",children:[a("div",{className:"stat-card",children:[e("h3",{children:"Chiffre d'Affaires"}),a("p",{className:"stat-value",children:["€",m.data.summary?.turnover||0]})]}),a("div",{className:"stat-card",children:[e("h3",{children:"Bénéfice"}),a("p",{className:"stat-value",children:["€",m.data.summary?.profit||0]})]}),a("div",{className:"stat-card",children:[e("h3",{children:"Employés"}),e("p",{className:"stat-value",children:m.data.summary?.employeeCount||0})]}),a("div",{className:"stat-card",children:[e("h3",{children:"Forfaits Actifs"}),e("p",{className:"stat-value",children:m.data.summary?.packageCount||0})]})]}):e("div",{className:"no-data",children:e("p",{children:"Aucune donnée disponible"})}),a("div",{className:"employees-section",children:[e("h2",{children:"Équipe"}),u.length>0?e("div",{className:"employees-grid",children:u.map(a=>e(F,{employee:a,onCardClick:K},a.id))}):a("div",{className:"no-employees",children:[e("p",{children:"Aucun employé enregistré"}),e("button",{onClick:()=>f(!0),className:"create-employee-button",children:"Créer le premier employé"})]})]})]}),e(w,{isOpen:y,onClose:()=>f(!1),onEmployeeCreated:e=>{p(a=>[...a,e]),W()}}),e(x,{isOpen:_,onClose:()=>P(!1),employee:C}),e(A,{isOpen:q,onClose:()=>R(!1)}),e(D,{isOpen:T,onClose:()=>M(!1)}),e($,{isOpen:O,onClose:()=>L(!1)}),e(E,{isOpen:I,onClose:()=>U(!1),onEmployeeUpdated:()=>{W()}}),e(S,{isOpen:j,onClose:()=>B(!1)})]})};export{_ as default};
