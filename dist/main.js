import{jsx as e,jsxs as a}from"react/jsx-runtime";import{createContext as n,useState as r,useCallback as t,useEffect as i,useContext as o,lazy as s,StrictMode as l}from"react";import{createRoot as d}from"react-dom/client";import{useLocation as c,Navigate as m,BrowserRouter as h,Routes as p,Route as u}from"react-router-dom";import g from"axios";const f=n(),v=({children:a})=>{const[n,o]=r(null),[s,l]=r(!0),[d,c]=r(localStorage.getItem("token")),m="http://localhost:3001/api/v1",h=t(async()=>{try{const e=await g.get(`${m}/auth/me`),a=e.data.data.user,n=e.data.data.employee,r={...a,employee:n};o(r)}catch(e){p()}finally{l(!1)}},[m]);i(()=>{d?(g.defaults.headers.common.Authorization=`Bearer ${d}`,h()):l(!1)},[d,h]);const p=()=>{o(null),c(null),localStorage.removeItem("token"),delete g.defaults.headers.common.Authorization},u={user:n,token:d,loading:s,login:async(e,a)=>{try{const n=await g.post(`${m}/auth/login`,{email:e,password:a}),{token:r,user:t,employee:i}=n.data.data;c(r),localStorage.setItem("token",r),g.defaults.headers.common.Authorization=`Bearer ${r}`;const s={...t,employee:i};return o(s),l(!1),{success:!0}}catch(n){return{success:!1,error:n.response?.data?.message||n.response?.data?.error||"Login failed"}}},register:async e=>{try{const a=await g.post(`${m}/auth/register`,e),{token:n}=a.data.data;return c(n),localStorage.setItem("token",n),g.defaults.headers.common.Authorization=`Bearer ${n}`,{success:!0}}catch(a){return{success:!1,error:a.response?.data?.message||"Registration failed"}}},logout:p,isAuthenticated:!!n,isAdmin:"admin"===n?.role||"superAdmin"===n?.role};return e(f.Provider,{value:u,children:a})},y=()=>{const e=o(f);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},A=({children:n,adminOnly:r=!1})=>{const{isAuthenticated:t,isAdmin:i,loading:o}=y(),s=c();return t?r&&!i?e(m,{to:"/dashboard",replace:!0}):n:o?a("div",{className:"loading-container",children:[e("div",{className:"loading-spinner"}),e("p",{children:"Loading..."})]}):e(m,{to:"/login",state:{from:s},replace:!0})},N=s(()=>import("./assets/Login-Dwq5toSy.js")),b=s(()=>import("./assets/Register-DpxuE41y.js")),k=s(()=>import("./assets/AdminDashboard-BcCh6BiK.js")),L=s(()=>import("./assets/EmployeeDashboard-BVnlCouW.js"));function S(){const{isAuthenticated:n,isAdmin:r,user:t,loading:i}=y();return i?a("div",{className:"loading-container",children:[e("div",{className:"loading-spinner"}),e("p",{children:"Loading..."})]}):a(p,{children:[e(u,{path:"/login",element:n?e(m,{to:"/dashboard",replace:!0}):e(Suspense,{fallback:a("div",{className:"loading-container",children:[e("div",{className:"loading-spinner"}),e("p",{children:"Loading..."})]}),children:e(N,{})})}),e(u,{path:"/register",element:n?e(m,{to:"/dashboard",replace:!0}):e(Suspense,{fallback:a("div",{className:"loading-container",children:[e("div",{className:"loading-spinner"}),e("p",{children:"Loading..."})]}),children:e(b,{})})}),e(u,{path:"/dashboard",element:e(A,{children:e(Suspense,r?{fallback:a("div",{className:"loading-container",children:[e("div",{className:"loading-spinner"}),e("p",{children:"Loading..."})]}),children:e(k,{})}:{fallback:a("div",{className:"loading-container",children:[e("div",{className:"loading-spinner"}),e("p",{children:"Loading..."})]}),children:e(L,{})})})}),e(u,{path:"/admin",element:e(A,{adminOnly:!0,children:e(Suspense,{fallback:a("div",{className:"loading-container",children:[e("div",{className:"loading-spinner"}),e("p",{children:"Loading..."})]}),children:e(k,{})})})}),e(u,{path:"/",element:e(m,{to:"/dashboard",replace:!0})})]})}function w(){return e(v,{children:e(h,{children:e("div",{className:"App",children:e(S,{})})})})}d(document.getElementById("root")).render(e(l,{children:e(w,{})}));export{y as u};
