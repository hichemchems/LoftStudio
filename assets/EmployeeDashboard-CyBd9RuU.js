import{r as e,c as a,j as s,u as t}from"./index-ByAoKMyo.js";import{l as c,B as i,C as n,a as l,b as o,d as r,p as d,e as m,f as h}from"./index-CPygCyx-.js";const u=({isAdmin:t=!1,onEdit:c,onDelete:i,onSelect:n})=>{const[l,o]=e.useState([]),[r,d]=e.useState(!0),[m,h]=e.useState(""),u="http://localhost:3001/api/v1";e.useEffect(()=>{j()},[]);const j=async()=>{try{const e=await a.get(`${u}/packages`);o(e.data.data||[])}catch(e){h("Failed to fetch packages"),console.error("Error fetching packages:",e)}finally{d(!1)}};return r?s.jsx("div",{className:"loading",children:"Loading packages..."}):m?s.jsx("div",{className:"error",children:m}):s.jsxs("div",{className:"package-list",children:[s.jsx("h3",{children:"Packages"}),0===l.length?s.jsx("p",{children:"No packages available."}):s.jsx("div",{className:"package-grid",children:l.map(e=>s.jsxs("div",{className:"package-card "+(e.is_active?"active":"inactive"),children:[s.jsx("h4",{children:e.name}),s.jsxs("p",{className:"price",children:["€",e.price]}),s.jsx("p",{className:"status "+(e.is_active?"active":"inactive"),children:e.is_active?"Active":"Inactive"}),!t&&s.jsx("div",{className:"package-actions",children:s.jsx("button",{onClick:()=>n(e),className:"select-btn",children:"Sélectionner"})}),t&&s.jsxs("div",{className:"package-actions",children:[s.jsx("button",{onClick:()=>c(e),className:"edit-btn",children:"Edit"}),s.jsx("button",{onClick:()=>(async(e,s)=>{try{await a.put(`${u}/packages/${e}/activate`,{is_active:!s}),j()}catch(t){h("Failed to update package status"),console.error("Error updating package:",t)}})(e.id,e.is_active),className:"activate-btn",children:e.is_active?"Deactivate":"Activate"}),s.jsx("button",{onClick:()=>i(e.id),className:"delete-btn",children:"Delete"})]})]},e.id))})]})};n.register(l,o,r,d,m,h);const j=()=>{const{user:n,logout:l,isAdmin:o}=t(),[r,d]=e.useState({today:{totalPackages:0,totalClients:0,totalRevenue:0,commission:0},week:{totalPackages:0,totalClients:0,totalRevenue:0,commission:0},month:{totalPackages:0,totalClients:0,totalRevenue:0,commission:0}}),[m,h]=e.useState(!0),[j,x]=e.useState(null),[g,v]=e.useState("today"),[p,N]=e.useState(!1),[b,k]=e.useState(!1),[y,C]=e.useState(()=>{const e=localStorage.getItem("selectedPackage");return e?JSON.parse(e):null}),f=e.useRef(null),S=e.useRef(null),w="http://localhost:3001/api/v1",P=e.useCallback(async()=>{const e=async e=>{try{const s=n.employee?.id||n.id;return(await a.get(`${w}/employees/${s}/stats?period=${e}`)).data.data}catch(s){throw console.error(`Failed to fetch ${e} stats:`,s),s}};try{h(!0),x(null);const[a,s,t]=await Promise.all([e("today"),e("week"),e("month")]);d({today:{totalPackages:a.totalPackages,totalClients:a.totalClients,totalRevenue:a.totalRevenue,commission:a.commission},week:{totalPackages:s.totalPackages,totalClients:s.totalClients,totalRevenue:s.totalRevenue,commission:s.commission},month:{totalPackages:t.totalPackages,totalClients:t.totalClients,totalRevenue:t.totalRevenue,commission:t.commission}})}catch{x("Failed to load statistics")}finally{h(!1)}},[n,w]);e.useEffect(()=>{if(n&&!o){P(),S.current=c(w.replace("/api/v1","")),S.current.on("dashboard-data-updated",()=>{console.log("Dashboard data updated, reloading stats..."),P()});const e=()=>{const e=(new Date).toDateString();localStorage.getItem("lastStatsDate")!==e&&(console.log("Date changed, resetting daily statistics"),localStorage.setItem("lastStatsDate",e),P())},a=new Date;localStorage.setItem("lastStatsDate",a.toDateString());const s=setInterval(e,6e4);return()=>{clearInterval(s),S.current&&S.current.disconnect()}}},[n,o,P,w]),e.useEffect(()=>{const e=e=>{f.current&&!f.current.contains(e.target)&&k(!1)};return b&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[b]);const D=e=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(e),R=e=>{switch(k(!1),e){case"choosePackage":N(!0);break;case"viewToday":E("today");break;case"viewWeek":E("week");break;case"viewMonth":E("month")}},E=e=>{v(e)};if(m)return s.jsxs("div",{className:"dashboard",children:[s.jsxs("header",{className:"dashboard-header",children:[s.jsx("h1",{children:"Employee Dashboard"}),s.jsxs("div",{className:"user-info",children:[s.jsxs("span",{children:["Welcome, ",n?.name||n?.username]}),s.jsx("button",{onClick:l,className:"logout-btn",children:"Logout"})]})]}),s.jsx("main",{className:"dashboard-content",children:s.jsxs("div",{className:"loading-container",children:[s.jsx("div",{className:"loading-spinner"}),s.jsx("p",{children:"Chargement de vos statistiques..."})]})})]});if(j)return s.jsxs("div",{className:"dashboard",children:[s.jsxs("header",{className:"dashboard-header",children:[s.jsx("h1",{children:"Employee Dashboard"}),s.jsxs("div",{className:"user-info",children:[s.jsxs("span",{children:["Welcome, ",n?.name||n?.username]}),s.jsx("button",{onClick:l,className:"logout-btn",children:"Logout"})]})]}),s.jsx("main",{className:"dashboard-content",children:s.jsxs("div",{className:"error-message",children:[s.jsx("h2",{children:"Erreur de chargement"}),s.jsx("p",{children:j}),s.jsx("p",{children:"Il semble qu'il n'y ait pas encore de données de ventes dans le système."}),s.jsx("button",{onClick:P,className:"retry-btn",children:"Réessayer"})]})})]});const I=r[g],A={labels:["Total Clients","Chiffre d'Affaires","Commission"],datasets:[{label:`Statistiques pour ${g}`,data:[I.totalClients,I.totalRevenue||0,I.commission],backgroundColor:["rgba(255, 99, 132, 0.6)","rgba(255, 206, 86, 0.6)","rgba(75, 192, 192, 0.6)"],borderColor:["rgba(255, 99, 132, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)"],borderWidth:1}]},F={responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:`Statistiques Employé - ${g.charAt(0).toUpperCase()+g.slice(1)}`}},scales:{y:{beginAtZero:!0}}};return s.jsxs("div",{className:"dashboard",children:[s.jsxs("header",{className:"dashboard-header",children:[s.jsx("h1",{children:"Employee Dashboard"}),s.jsxs("div",{className:"user-info",children:[s.jsxs("span",{children:["Welcome, ",n?.name||n?.username]}),s.jsx("button",{onClick:()=>{k(!b)},className:"hamburger-btn",children:"☰"})]})]}),b&&s.jsxs("div",{className:"hamburger-menu",ref:f,children:[s.jsx("button",{onClick:()=>R("choosePackage"),className:"menu-item",children:"Choisir Forfait"}),s.jsx("button",{onClick:()=>R("viewToday"),className:"menu-item",children:"Voir Aujourd'hui"}),s.jsx("button",{onClick:()=>R("viewWeek"),className:"menu-item",children:"Voir Semaine"}),s.jsx("button",{onClick:()=>R("viewMonth"),className:"menu-item",children:"Voir Mois"}),s.jsx("div",{className:"menu-divider"}),s.jsx("button",{onClick:l,className:"menu-item logout-item",children:"Déconnexion"})]}),s.jsxs("main",{className:"dashboard-content",children:[y&&s.jsxs("div",{className:"selected-package-card",children:[s.jsx("h3",{children:"Forfait Sélectionné"}),s.jsxs("div",{className:"package-info",children:[s.jsx("h4",{children:y.name}),s.jsxs("p",{className:"price",children:["€",y.price]})]})]}),s.jsxs("div",{className:"employee-stats",children:[s.jsxs("div",{className:"stat-card",children:[s.jsx("h3",{children:"Total Clients"}),s.jsx("p",{className:"stat-value",children:I.totalClients}),s.jsxs("span",{className:"period-label",children:["(",g,")"]})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("h3",{children:"Chiffre d'Affaires"}),s.jsx("p",{className:"stat-value revenue",children:D(I.totalRevenue||0)}),s.jsxs("span",{className:"period-label",children:["(",g,")"]})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("h3",{children:"Commission"}),s.jsx("p",{className:"stat-value commission",children:D(I.commission)}),s.jsxs("span",{className:"period-label",children:["(",g,")"]})]})]}),s.jsx("div",{className:"chart-container",children:s.jsx(i,{data:A,options:F})}),s.jsxs("div",{className:"period-selector",children:[s.jsx("h3",{children:"Période"}),s.jsxs("div",{className:"period-buttons",children:[s.jsx("button",{className:"today"===g?"active":"",onClick:()=>E("today"),children:"Aujourd'hui"}),s.jsx("button",{className:"week"===g?"active":"",onClick:()=>E("week"),children:"Semaine"}),s.jsx("button",{className:"month"===g?"active":"",onClick:()=>E("month"),children:"Mois"})]})]})]}),p&&s.jsx("div",{className:"modal-overlay",children:s.jsxs("div",{className:"modal-content package-modal",children:[s.jsx("h3",{children:"Choisir un Forfait"}),s.jsx(u,{isAdmin:!1,onSelect:async e=>{try{const s=n.employee?.id||n.id;await a.put(`${w}/employees/${s}/select-package`,{packageId:e.id}),C(e),localStorage.setItem("selectedPackage",JSON.stringify(e)),N(!1)}catch(s){console.error("Failed to select package:",s),C(e),localStorage.setItem("selectedPackage",JSON.stringify(e)),N(!1)}}}),s.jsx("div",{className:"modal-actions",children:s.jsx("button",{onClick:()=>N(!1),className:"close-btn",children:"Fermer"})})]})})]})};export{j as default};
