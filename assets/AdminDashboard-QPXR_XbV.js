import{r as e,j as a,c as s,u as l}from"./index-ByAoKMyo.js";import{L as n,B as t,D as r,C as i,a as c,b as o,P as d,c as m,d as h,p as u,e as p,f as x,A as j,l as v}from"./index-CPygCyx-.js";const g=({isOpen:l,onClose:n,onEmployeeCreated:t})=>{const[r,i]=e.useState({username:"",email:"",password:"",name:"",percentage:""}),[c,o]=e.useState(null),[d,m]=e.useState(!1),[h,u]=e.useState(""),p=e=>{const{name:a,value:s}=e.target;i(e=>({...e,[a]:s}))};return l?a.jsx("div",{className:"modal-overlay",children:a.jsxs("div",{className:"modal-content",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("h2",{children:"Créer un nouveau compte employé"}),a.jsx("button",{className:"close-button",onClick:n,children:"×"})]}),a.jsxs("form",{onSubmit:async e=>{e.preventDefault(),m(!0),u("");try{const e=new FormData;e.append("username",r.username),e.append("email",r.email),e.append("password",r.password),e.append("name",r.name),e.append("percentage",r.percentage),c&&e.append("photo",c);const a=await s.post("http://localhost:3001/api/v1/auth/create-employee",e,{headers:{"Content-Type":"multipart/form-data"}});a.data.success&&(t(a.data.data.employee),n(),i({username:"",email:"",password:"",name:"",percentage:""}),o(null))}catch(a){console.error("Error creating employee:",a),u(a.response?.data?.message||"Erreur lors de la création de l'employé")}finally{m(!1)}},className:"employee-form",children:[h&&a.jsx("div",{className:"error-message",children:h}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"name",children:"Nom et Prénom *"}),a.jsx("input",{type:"text",id:"name",name:"name",value:r.name,onChange:p,required:!0,placeholder:"Ex: Jean Dupont"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"username",children:"Nom d'utilisateur *"}),a.jsx("input",{type:"text",id:"username",name:"username",value:r.username,onChange:p,required:!0,placeholder:"Ex: jean_dupont"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"email",children:"Email *"}),a.jsx("input",{type:"email",id:"email",name:"email",value:r.email,onChange:p,required:!0,placeholder:"Ex: jean.dupont@email.com"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"password",children:"Mot de passe *"}),a.jsx("input",{type:"password",id:"password",name:"password",value:r.password,onChange:p,required:!0,placeholder:"Mot de passe sécurisé"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"percentage",children:"Pourcentage de commission *"}),a.jsx("input",{type:"number",id:"percentage",name:"percentage",value:r.percentage,onChange:p,required:!0,min:"0",max:"100",step:"0.1",placeholder:"Ex: 15.5"}),a.jsx("small",{className:"form-help",children:"Pourcentage calculé sur le Hors Tax des forfaits"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"photo",children:"Photo de profil"}),a.jsx("input",{type:"file",id:"photo",name:"photo",onChange:e=>{const a=e.target.files[0];a&&o(a)},accept:"image/*"}),a.jsx("small",{className:"form-help",children:"Formats acceptés: JPG, PNG, GIF"})]}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",onClick:n,className:"cancel-button",children:"Annuler"}),a.jsx("button",{type:"submit",disabled:d,className:"submit-button",children:d?"Création...":"Créer l'employé"})]})]})]})}):null},N=({employee:s,onCardClick:l})=>{const[n,t]=e.useState(!1),r=e=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(e);return a.jsxs("div",{className:"employee-card",onClick:()=>l(s),children:[a.jsx("div",{className:"employee-avatar",children:!n&&s.avatar_url?a.jsx("img",{src:`http://localhost:3001${s.avatar_url}`,alt:`${s.name} avatar`,onError:()=>{t(!0)}}):a.jsx("div",{className:"avatar-placeholder",children:s.name.charAt(0).toUpperCase()})}),a.jsxs("div",{className:"employee-info",children:[a.jsx("h3",{className:"employee-name",children:s.name}),a.jsxs("div",{className:"employee-stats",children:[a.jsxs("div",{className:"stat-item",children:[a.jsx("span",{className:"stat-label",children:"Forfaits (mois)"}),a.jsx("span",{className:"stat-value",children:s.monthStats?.packageCount||0})]}),a.jsxs("div",{className:"stat-item",children:[a.jsx("span",{className:"stat-label",children:"Total Clients (mois)"}),a.jsx("span",{className:"stat-value",children:s.monthStats?.totalClients||0})]}),a.jsxs("div",{className:"stat-item",children:[a.jsx("span",{className:"stat-label",children:"Chiffre d'Affaires (mois)"}),a.jsx("span",{className:"stat-value revenue",children:r(s.monthStats?.totalRevenue||0)})]}),a.jsxs("div",{className:"stat-item",children:[a.jsxs("span",{className:"stat-label",children:["Commission (",s.percentage,"%)"]}),a.jsx("span",{className:"stat-value commission",children:r(s.monthStats?.commission||0)})]}),s.selectedPackage&&a.jsxs("div",{className:"stat-item",children:[a.jsx("span",{className:"stat-label",children:"Forfait sélectionné"}),a.jsx("span",{className:"stat-value package-name",children:s.selectedPackage.name})]})]})]}),a.jsx("div",{className:"card-indicator",children:a.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:a.jsx("path",{d:"M9 5L16 12L9 19",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]})},b=({isOpen:l,onClose:n,employee:t})=>{const[r,i]=e.useState("today"),[c,o]=e.useState(null),[d,m]=e.useState(!1);e.useEffect(()=>{l&&t&&h()},[l,t,r]);const h=async()=>{if(t){m(!0);try{const e=await s.get(`http://localhost:3001/api/v1/employees/${t.id}/detailed-stats?period=${r}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});e.data.success?o(e.data.data):(console.error("Failed to fetch detailed stats:",e.data.message),o(null))}catch(e){console.error("Error fetching detailed stats:",e),o(null)}finally{m(!1)}}},u=e=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(e);return l&&t?a.jsx("div",{className:"modal-overlay",children:a.jsxs("div",{className:"modal-content large-modal",children:[a.jsxs("div",{className:"modal-header",children:[a.jsxs("div",{className:"employee-header-info",children:[a.jsx("div",{className:"employee-avatar",children:t.avatar_url?a.jsx("img",{src:`http://localhost:3001${t.avatar_url}`,alt:`${t.name} avatar`}):a.jsx("div",{className:"avatar-placeholder",children:t.name.charAt(0).toUpperCase()})}),a.jsxs("div",{children:[a.jsx("h2",{children:t.name}),a.jsxs("p",{className:"employee-percentage",children:["Commission: ",t.percentage,"% sur HT"]})]})]}),a.jsx("button",{className:"close-button",onClick:n,children:"×"})]}),a.jsxs("div",{className:"modal-body",children:[a.jsxs("div",{className:"tabs",children:[a.jsx("button",{className:"tab-button "+("today"===r?"active":""),onClick:()=>i("today"),children:"Aujourd'hui"}),a.jsx("button",{className:"tab-button "+("week"===r?"active":""),onClick:()=>i("week"),children:"Cette semaine"}),a.jsx("button",{className:"tab-button "+("month"===r?"active":""),onClick:()=>i("month"),children:"Ce mois"}),a.jsx("button",{className:"tab-button "+("year"===r?"active":""),onClick:()=>i("year"),children:"Cette année"})]}),d?a.jsx("div",{className:"loading",children:"Chargement des données..."}):c?a.jsxs("div",{className:"stats-content",children:[a.jsxs("div",{className:"stats-summary",children:[a.jsxs("div",{className:"summary-card",children:[a.jsx("h3",{children:"Forfaits réalisés"}),a.jsx("p",{className:"summary-value",children:c.totalPackages})]}),a.jsxs("div",{className:"summary-card",children:[a.jsx("h3",{children:"CA généré (HT)"}),a.jsx("p",{className:"summary-value",children:u(c.totalRevenue)})]}),a.jsxs("div",{className:"summary-card",children:[a.jsx("h3",{children:"Commission totale"}),a.jsx("p",{className:"summary-value commission",children:u(c.totalCommission)})]})]}),a.jsxs("div",{className:"packages-list",children:[a.jsx("h3",{children:"Détail des forfaits"}),a.jsxs("div",{className:"packages-table",children:[a.jsxs("div",{className:"table-header",children:[a.jsx("span",{children:"Date"}),a.jsx("span",{children:"Client"}),a.jsx("span",{children:"Forfait"}),a.jsx("span",{children:"Prix HT"}),a.jsx("span",{children:"Commission"})]}),c.packages.map(e=>{return a.jsxs("div",{className:"table-row",children:[a.jsx("span",{children:(s=e.date,new Date(s).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}))}),a.jsx("span",{children:e.client_name}),a.jsx("span",{children:e.package_name}),a.jsx("span",{children:u(e.ht_price)}),a.jsx("span",{className:"commission",children:u(e.commission)})]},e.id);var s})]})]})]}):a.jsx("div",{className:"no-data",children:"Aucune donnée disponible"})]})]})}):null},y=({isOpen:l,onClose:n,onEmployeeUpdated:t})=>{const[r,i]=e.useState([]),[c,o]=e.useState(!1),[d,m]=e.useState(""),[h,u]=e.useState(null),[p,x]=e.useState({username:"",email:"",name:"",percentage:"",password:""}),j="http://localhost:3001/api/v1";e.useEffect(()=>{l&&v()},[l]);const v=e.useCallback(async()=>{o(!0);try{const e=await s.get(`${j}/employees`);i(e.data.data||[])}catch(e){console.error("Error fetching employees:",e),m("Erreur lors du chargement des employés")}finally{o(!1)}},[j]),g=e=>{const{name:a,value:s}=e.target;x(e=>({...e,[a]:s}))},N=()=>{x({username:"",email:"",name:"",percentage:"",password:""})};return l?a.jsx("div",{className:"modal-overlay",children:a.jsxs("div",{className:"modal-content large-modal",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("h2",{children:"Gestion des comptes employés"}),a.jsx("button",{className:"close-button",onClick:n,children:"×"})]}),a.jsxs("div",{className:"modal-body",children:[d&&a.jsx("div",{className:"error-message",children:d}),a.jsx("div",{className:"employee-summary",children:a.jsxs("div",{className:"summary-card",children:[a.jsx("h3",{children:"Total employés"}),a.jsx("p",{className:"total-count",children:r.length})]})}),h&&a.jsxs("form",{onSubmit:async e=>{e.preventDefault(),o(!0),m("");try{const e={...p,percentage:parseFloat(p.percentage)||0};e.password||delete e.password,h&&await s.put(`${j}/employees/${h.id}`,e),await v(),t(),N(),u(null)}catch(a){console.error("Error saving employee:",a),m(a.response?.data?.message||"Erreur lors de la sauvegarde")}finally{o(!1)}},className:"employee-form",children:[a.jsx("h3",{children:"Modifier le compte employé"}),a.jsxs("div",{className:"form-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"username",children:"Nom d'utilisateur *"}),a.jsx("input",{type:"text",id:"username",name:"username",value:p.username,onChange:g,required:!0,placeholder:"nom_utilisateur"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"email",children:"Email *"}),a.jsx("input",{type:"email",id:"email",name:"email",value:p.email,onChange:g,required:!0,placeholder:"email@exemple.com"})]})]}),a.jsxs("div",{className:"form-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"name",children:"Nom complet *"}),a.jsx("input",{type:"text",id:"name",name:"name",value:p.name,onChange:g,required:!0,placeholder:"Prénom Nom"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"percentage",children:"Pourcentage (%)"}),a.jsx("input",{type:"number",id:"percentage",name:"percentage",value:p.percentage,onChange:g,min:"0",max:"100",step:"0.1",placeholder:"Ex: 10.5"})]})]}),a.jsx("div",{className:"form-row",children:a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"password",children:"Nouveau mot de passe (laisser vide pour garder l'actuel)"}),a.jsx("input",{type:"password",id:"password",name:"password",value:p.password,onChange:g,placeholder:"Nouveau mot de passe"})]})}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",onClick:()=>{N(),u(null)},className:"cancel-button",children:"Annuler"}),a.jsx("button",{type:"submit",disabled:c,className:"submit-button",children:c?"Sauvegarde...":"Modifier"})]})]}),a.jsxs("div",{className:"employees-list",children:[a.jsx("h3",{children:"Comptes employés"}),c&&!h?a.jsx("div",{className:"loading",children:"Chargement des employés..."}):r.length>0?a.jsxs("div",{className:"employees-table",children:[a.jsxs("div",{className:"table-header",children:[a.jsx("span",{children:"Nom"}),a.jsx("span",{children:"Utilisateur"}),a.jsx("span",{children:"Email"}),a.jsx("span",{children:"Pourcentage"}),a.jsx("span",{children:"Date création"}),a.jsx("span",{children:"Actions"})]}),r.map(e=>{return a.jsxs("div",{className:"table-row",children:[a.jsx("span",{className:"employee-name",children:e.name}),a.jsx("span",{children:e.user?.username}),a.jsx("span",{children:e.user?.email}),a.jsx("span",{children:e.percentage?`${e.percentage}%`:"N/A"}),a.jsx("span",{children:(l=e.created_at,new Date(l).toLocaleDateString("fr-FR"))}),a.jsxs("span",{className:"actions",children:[a.jsx("button",{onClick:()=>(e=>{u(e),x({username:e.user?.username||"",email:e.user?.email||"",name:e.name||"",percentage:e.percentage?.toString()||"",password:""})})(e),className:"edit-button",children:"✏️"}),a.jsx("button",{onClick:()=>(async e=>{if(window.confirm(`Êtes-vous sûr de vouloir supprimer le compte "${e.name}" ? Cette action est irréversible.`)){o(!0);try{await s.delete(`${j}/employees/${e.id}`),await v(),t()}catch(a){console.error("Error deleting employee:",a),m("Erreur lors de la suppression")}finally{o(!1)}}})(e),className:"delete-button",children:"🗑️"})]})]},e.id);var l})]}):a.jsx("div",{className:"no-data",children:"Aucun employé enregistré"})]})]})]})}):null},f=({isOpen:l,onClose:n})=>{const[t,r]=e.useState([]),[i,c]=e.useState(!1),[o,d]=e.useState(""),[m,h]=e.useState(!1),[u,p]=e.useState(null),[x,j]=e.useState({description:"",amount:"",date:(new Date).toISOString().split("T")[0],category:""}),v="http://localhost:3001/api/v1";e.useEffect(()=>{l&&g()},[l]);const g=e.useCallback(async()=>{c(!0);try{const e=await s.get(`${v}/dashboard/expenses`);r(e.data.data||[])}catch(e){console.error("Error fetching expenses:",e),d("Erreur lors du chargement des charges")}finally{c(!1)}},[v]),N=e=>{const{name:a,value:s}=e.target;j(e=>({...e,[a]:s}))},b=()=>{j({description:"",amount:"",date:(new Date).toISOString().split("T")[0],category:""})},y=e=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(e);return l?a.jsx("div",{className:"modal-overlay",children:a.jsxs("div",{className:"modal-content large-modal",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("h2",{children:"Gestion des charges"}),a.jsx("button",{className:"close-button",onClick:n,children:"×"})]}),a.jsxs("div",{className:"modal-body",children:[o&&a.jsx("div",{className:"error-message",children:o}),a.jsx("div",{className:"expense-summary",children:a.jsxs("div",{className:"summary-card",children:[a.jsx("h3",{children:"Total des charges"}),a.jsx("p",{className:"total-amount",children:y(t.reduce((e,a)=>e+parseFloat(a.amount),0))})]})}),a.jsx("div",{className:"modal-actions",children:a.jsx("button",{onClick:()=>{b(),p(null),h(!m)},className:"action-button primary",children:m?"Annuler":"+ Nouvelle charge"})}),m&&a.jsxs("form",{onSubmit:async e=>{e.preventDefault(),c(!0),d("");try{const e={...x,amount:parseFloat(x.amount)};u?await s.put(`${v}/dashboard/expenses/${u.id}`,e):await s.post(`${v}/dashboard/expenses`,e),await g(),b(),h(!1),p(null)}catch(a){console.error("Error saving expense:",a),d(a.response?.data?.message||"Erreur lors de la sauvegarde")}finally{c(!1)}},className:"expense-form",children:[a.jsx("h3",{children:u?"Modifier la charge":"Enregistrer une nouvelle charge"}),a.jsxs("div",{className:"form-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"description",children:"Description *"}),a.jsx("input",{type:"text",id:"description",name:"description",value:x.description,onChange:N,required:!0,placeholder:"Ex: Fournitures de coiffure"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"amount",children:"Montant (€) *"}),a.jsx("input",{type:"number",id:"amount",name:"amount",value:x.amount,onChange:N,required:!0,min:"0",step:"0.01",placeholder:"Ex: 150.00"})]})]}),a.jsxs("div",{className:"form-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"date",children:"Date *"}),a.jsx("input",{type:"date",id:"date",name:"date",value:x.date,onChange:N,required:!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"category",children:"Catégorie"}),a.jsxs("select",{id:"category",name:"category",value:x.category,onChange:N,children:[a.jsx("option",{value:"",children:"Sélectionner une catégorie"}),a.jsx("option",{value:"fournitures",children:"Fournitures"}),a.jsx("option",{value:"loyer",children:"Loyer"}),a.jsx("option",{value:"utilities",children:"Utilitaires"}),a.jsx("option",{value:"marketing",children:"Marketing"}),a.jsx("option",{value:"autres",children:"Autres"})]})]})]}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",onClick:()=>h(!1),className:"cancel-button",children:"Annuler"}),a.jsx("button",{type:"submit",disabled:i,className:"submit-button",children:i?"Sauvegarde...":u?"Modifier":"Enregistrer"})]})]}),a.jsxs("div",{className:"expenses-list",children:[a.jsx("h3",{children:"Charges enregistrées"}),i&&!m?a.jsx("div",{className:"loading",children:"Chargement des charges..."}):t.length>0?a.jsxs("div",{className:"expenses-table",children:[a.jsxs("div",{className:"table-header",children:[a.jsx("span",{children:"Description"}),a.jsx("span",{children:"Montant"}),a.jsx("span",{children:"Date"}),a.jsx("span",{children:"Catégorie"}),a.jsx("span",{children:"Actions"})]}),t.map(e=>{return a.jsxs("div",{className:"table-row",children:[a.jsx("span",{className:"expense-description",children:e.description}),a.jsx("span",{children:y(e.amount)}),a.jsx("span",{children:(l=e.date,new Date(l).toLocaleDateString("fr-FR"))}),a.jsx("span",{className:"category",children:e.category||"Non catégorisé"}),a.jsxs("span",{className:"actions",children:[a.jsx("button",{onClick:()=>(e=>{p(e),j({description:e.description,amount:e.amount.toString(),date:e.date,category:e.category||""}),h(!0)})(e),className:"edit-button",children:"✏️"}),a.jsx("button",{onClick:()=>(async e=>{if(window.confirm(`Êtes-vous sûr de vouloir supprimer cette charge "${e.description}" ?`)){c(!0);try{await s.delete(`${v}/dashboard/expenses/${e.id}`),await g()}catch(a){console.error("Error deleting expense:",a),d("Erreur lors de la suppression")}finally{c(!1)}}})(e),className:"delete-button",children:"🗑️"})]})]},e.id);var l})]}):a.jsx("div",{className:"no-data",children:"Aucune charge enregistrée pour le moment"})]})]})]})}):null},C=({isOpen:l,onClose:n})=>{const[t,r]=e.useState([]),[i,c]=e.useState(!1),[o,d]=e.useState(""),[m,h]=e.useState(!1),[u,p]=e.useState(null),[x,j]=e.useState({name:"",price:"",description:"",duration_minutes:"",is_active:!0}),v="http://localhost:3001/api/v1";e.useEffect(()=>{l&&g()},[l]);const g=async()=>{c(!0);try{const e=await s.get(`${v}/packages`);r(e.data.data||[])}catch(e){console.error("Error fetching packages:",e),d("Erreur lors du chargement des forfaits")}finally{c(!1)}},N=e=>{const{name:a,value:s,type:l,checked:n}=e.target;j(e=>({...e,[a]:"checkbox"===l?n:s}))},b=()=>{j({name:"",price:"",description:"",duration_minutes:"",is_active:!0})};return l?a.jsx("div",{className:"modal-overlay",children:a.jsxs("div",{className:"modal-content large-modal",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("h2",{children:"Gestion des forfaits"}),a.jsx("button",{className:"close-button",onClick:n,children:"×"})]}),a.jsxs("div",{className:"modal-body",children:[o&&a.jsx("div",{className:"error-message",children:o}),a.jsx("div",{className:"modal-actions",children:a.jsx("button",{onClick:()=>{b(),p(null),h(!m)},className:"action-button primary",children:m?"Annuler":"+ Nouveau forfait"})}),m&&a.jsxs("form",{onSubmit:async e=>{e.preventDefault(),c(!0),d("");try{const e={...x,price:parseFloat(x.price),duration_minutes:parseInt(x.duration_minutes)};u?await s.put(`${v}/packages/${u.id}`,e):await s.post(`${v}/packages`,e),await g(),b(),h(!1),p(null)}catch(a){console.error("Error saving package:",a),d(a.response?.data?.message||"Erreur lors de la sauvegarde")}finally{c(!1)}},className:"package-form",children:[a.jsx("h3",{children:u?"Modifier le forfait":"Créer un nouveau forfait"}),a.jsxs("div",{className:"form-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"name",children:"Nom du forfait *"}),a.jsx("input",{type:"text",id:"name",name:"name",value:x.name,onChange:N,required:!0,placeholder:"Ex: Coupe + brushing"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"price",children:"Prix HT (€) *"}),a.jsx("input",{type:"number",id:"price",name:"price",value:x.price,onChange:N,required:!0,min:"0",step:"0.01",placeholder:"Ex: 45.00"})]})]}),a.jsxs("div",{className:"form-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"duration_minutes",children:"Durée (minutes) *"}),a.jsx("input",{type:"number",id:"duration_minutes",name:"duration_minutes",value:x.duration_minutes,onChange:N,required:!0,min:"1",placeholder:"Ex: 60"})]}),a.jsx("div",{className:"form-group",children:a.jsxs("label",{className:"checkbox-label",children:[a.jsx("input",{type:"checkbox",name:"is_active",checked:x.is_active,onChange:N}),"Forfait actif"]})})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"description",children:"Description"}),a.jsx("textarea",{id:"description",name:"description",value:x.description,onChange:N,rows:"3",placeholder:"Description optionnelle du forfait"})]}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",onClick:()=>h(!1),className:"cancel-button",children:"Annuler"}),a.jsx("button",{type:"submit",disabled:i,className:"submit-button",children:i?"Sauvegarde...":u?"Modifier":"Créer"})]})]}),a.jsxs("div",{className:"packages-list",children:[a.jsx("h3",{children:"Forfaits existants"}),i&&!m?a.jsx("div",{className:"loading",children:"Chargement des forfaits..."}):t.length>0?a.jsxs("div",{className:"packages-table",children:[a.jsxs("div",{className:"table-header",children:[a.jsx("span",{children:"Nom"}),a.jsx("span",{children:"Prix HT"}),a.jsx("span",{children:"Durée"}),a.jsx("span",{children:"Statut"}),a.jsx("span",{children:"Actions"})]}),t.map(e=>{return a.jsxs("div",{className:"table-row",children:[a.jsx("span",{className:"package-name",children:e.name}),a.jsx("span",{children:(l=e.price,new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(l))}),a.jsxs("span",{children:[e.duration_minutes," min"]}),a.jsx("span",{children:a.jsx("button",{onClick:()=>(async e=>{c(!0);try{await s.put(`${v}/packages/${e.id}`,{...e,is_active:!e.is_active}),await g()}catch(a){console.error("Error toggling package status:",a),d("Erreur lors de la modification du statut")}finally{c(!1)}})(e),className:"status-button "+(e.is_active?"active":"inactive"),children:e.is_active?"Actif":"Inactif"})}),a.jsxs("span",{className:"actions",children:[a.jsx("button",{onClick:()=>(e=>{p(e),j({name:e.name,price:e.price.toString(),description:e.description||"",duration_minutes:e.duration_minutes.toString(),is_active:e.is_active}),h(!0)})(e),className:"edit-button",children:"✏️"}),a.jsx("button",{onClick:()=>(async e=>{if(window.confirm(`Êtes-vous sûr de vouloir supprimer le forfait "${e.name}" ?`)){c(!0);try{await s.delete(`${v}/packages/${e.id}`),await g()}catch(a){console.error("Error deleting package:",a),d("Erreur lors de la suppression")}finally{c(!1)}}})(e),className:"delete-button",children:"🗑️"})]})]},e.id);var l})]}):a.jsx("div",{className:"no-data",children:"Aucun forfait créé pour le moment"})]})]})]})}):null};i.register(c,o,d,m,h,u,p,x,j);const k=({isOpen:l,onClose:i})=>{const[c,o]=e.useState(null),[d,m]=e.useState(!1),[h,u]=e.useState(""),[p,x]=e.useState("month"),[j,v]=e.useState("revenue"),g="http://localhost:3001/api/v1";e.useEffect(()=>{l&&N()},[l,p]);const N=e.useCallback(async()=>{m(!0);try{const e=await s.get(`${g}/dashboard/analytics?period=${p}`);o(e.data.data)}catch(e){console.error("Error fetching statistics:",e),u("Erreur lors du chargement des statistiques")}finally{m(!1)}},[g,p]),b=e=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(e||0),y=e=>new Date(e).toLocaleDateString("fr-FR",{month:"short",year:"numeric"}),f=()=>c?.monthlyData?{labels:c.monthlyData.map(e=>y(e.month)),datasets:[{label:"Chiffre d'affaires",data:c.monthlyData.map(e=>e.revenue),borderColor:"#007bff",backgroundColor:"rgba(0, 123, 255, 0.1)",tension:.4},{label:"Charges",data:c.monthlyData.map(e=>e.expenses),borderColor:"#dc3545",backgroundColor:"rgba(220, 53, 69, 0.1)",tension:.4},{label:"Bénéfice",data:c.monthlyData.map(e=>e.profit),borderColor:"#28a745",backgroundColor:"rgba(40, 167, 69, 0.1)",tension:.4}]}:null,C=()=>c?.monthlyData?{labels:c.monthlyData.map(e=>y(e.month)),datasets:[{label:"Ventes",data:c.monthlyData.map(e=>e.sales),backgroundColor:"#007bff"},{label:"Recettes",data:c.monthlyData.map(e=>e.receipts),backgroundColor:"#28a745"}]}:null,k=()=>c?.packageStats?{labels:c.packageStats.map(e=>e.name),datasets:[{data:c.packageStats.map(e=>e.count),backgroundColor:["#007bff","#28a745","#ffc107","#dc3545","#6f42c1","#e83e8c","#fd7e14"]}]}:null,w=()=>c?.employeeStats?{labels:c.employeeStats.map(e=>e.name),datasets:[{label:"Chiffre d'affaires généré",data:c.employeeStats.map(e=>e.revenue),backgroundColor:"#007bff"}]}:null;return l?a.jsx("div",{className:"modal-overlay",children:a.jsxs("div",{className:"modal-content large-modal",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("h2",{children:"Statistiques et Analyses"}),a.jsx("button",{className:"close-button",onClick:i,children:"×"})]}),a.jsxs("div",{className:"modal-body",children:[h&&a.jsx("div",{className:"error-message",children:h}),a.jsx("div",{className:"stats-controls",children:a.jsxs("div",{className:"time-range-selector",children:[a.jsx("label",{children:"Période:"}),a.jsxs("select",{value:p,onChange:e=>x(e.target.value),children:[a.jsx("option",{value:"week",children:"Cette semaine"}),a.jsx("option",{value:"month",children:"Ce mois"}),a.jsx("option",{value:"quarter",children:"Ce trimestre"}),a.jsx("option",{value:"year",children:"Cette année"})]})]})}),d?a.jsx("div",{className:"loading",children:"Chargement des statistiques..."}):c?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"stats-summary",children:a.jsxs("div",{className:"summary-grid",children:[a.jsxs("div",{className:"summary-card",children:[a.jsx("h4",{children:"Chiffre d'affaires total"}),a.jsx("p",{className:"summary-value",children:b(c.totalRevenue)})]}),a.jsxs("div",{className:"summary-card",children:[a.jsx("h4",{children:"Charges totales"}),a.jsx("p",{className:"summary-value",children:b(c.totalExpenses)})]}),a.jsxs("div",{className:"summary-card",children:[a.jsx("h4",{children:"Bénéfice net"}),a.jsx("p",{className:"summary-value "+(c.totalProfit>=0?"positive":"negative"),children:b(c.totalProfit)})]}),a.jsxs("div",{className:"summary-card",children:[a.jsx("h4",{children:"Marge bénéficiaire"}),a.jsxs("p",{className:"summary-value",children:[c.profitMargin,"%"]})]})]})}),a.jsxs("div",{className:"stats-tabs",children:[a.jsx("button",{className:"tab-button "+("revenue"===j?"active":""),onClick:()=>v("revenue"),children:"Évolution CA"}),a.jsx("button",{className:"tab-button "+("sales"===j?"active":""),onClick:()=>v("sales"),children:"Ventes & Recettes"}),a.jsx("button",{className:"tab-button "+("packages"===j?"active":""),onClick:()=>v("packages"),children:"Popularité forfaits"}),a.jsx("button",{className:"tab-button "+("employees"===j?"active":""),onClick:()=>v("employees"),children:"Performance employés"})]}),a.jsxs("div",{className:"chart-container",children:["revenue"===j&&f()&&a.jsxs("div",{className:"chart-wrapper",children:[a.jsx("h3",{children:"Évolution du Chiffre d'Affaires"}),a.jsx(n,{data:f(),options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return b(e)}}}}}})]}),"sales"===j&&C()&&a.jsxs("div",{className:"chart-wrapper",children:[a.jsx("h3",{children:"Ventes et Recettes par période"}),a.jsx(t,{data:C(),options:{responsive:!0,plugins:{legend:{position:"top"}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return b(e)}}}}}})]}),"packages"===j&&k()&&a.jsxs("div",{className:"chart-wrapper",children:[a.jsx("h3",{children:"Popularité des forfaits"}),a.jsx(r,{data:k(),options:{responsive:!0,plugins:{legend:{position:"right"}}}})]}),"employees"===j&&w()&&a.jsxs("div",{className:"chart-wrapper",children:[a.jsx("h3",{children:"Performance des employés"}),a.jsx(t,{data:w(),options:{responsive:!0,plugins:{legend:{position:"top"}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return b(e)}}}}}})]})]})]}):a.jsx("div",{className:"no-data",children:"Aucune donnée statistique disponible"})]})]})}):null},w=({isOpen:l,onClose:n})=>{const[t,r]=e.useState(null),[i,c]=e.useState(!1),[o,d]=e.useState(""),[m,h]=e.useState((new Date).getFullYear());e.useEffect(()=>{l&&(async e=>{c(!0),d("");try{const a=await s.get(`http://localhost:3001/api/v1/dashboard/reports/annual-profit?year=${e}`);r(a.data.data)}catch(a){console.error("Failed to fetch annual profit data:",a),d("Erreur lors du chargement des données")}finally{c(!1)}})(m)},[l,m]);return l?a.jsx("div",{className:"modal-overlay",children:a.jsxs("div",{className:"modal-content annual-profit-modal",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("h2",{children:"Bénéfices Annuels"}),a.jsx("button",{onClick:n,className:"close-button",children:"×"})]}),a.jsxs("div",{className:"modal-body",children:[a.jsxs("div",{className:"year-selector",children:[a.jsx("label",{htmlFor:"year-select",children:"Année:"}),a.jsx("select",{id:"year-select",value:m,onChange:e=>{return a=parseInt(e.target.value),void h(a);var a},children:(()=>{const e=(new Date).getFullYear(),a=[];for(let s=e;s>=e-5;s--)a.push(s);return a})().map(e=>a.jsx("option",{value:e,children:e},e))})]}),i&&a.jsxs("div",{className:"loading-container",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Chargement des données..."})]}),o&&a.jsx("div",{className:"error-message",children:o}),t&&!i&&a.jsxs("div",{className:"annual-profit-content",children:[a.jsxs("div",{className:"annual-summary",children:[a.jsxs("h3",{children:["Résumé Annuel ",t.year]}),a.jsxs("div",{className:"summary-cards",children:[a.jsxs("div",{className:"summary-card",children:[a.jsx("h4",{children:"Chiffre d'Affaires Total"}),a.jsxs("p",{className:"summary-value",children:["€",t.annualTotals.totalTurnover.toFixed(2)]})]}),a.jsxs("div",{className:"summary-card",children:[a.jsx("h4",{children:"Charges Totales"}),a.jsxs("p",{className:"summary-value",children:["€",t.annualTotals.totalExpenses.toFixed(2)]})]}),a.jsxs("div",{className:"summary-card",children:[a.jsx("h4",{children:"Commissions Totales"}),a.jsxs("p",{className:"summary-value",children:["€",t.annualTotals.totalCommissions.toFixed(2)]})]}),a.jsxs("div",{className:"summary-card profit-card",children:[a.jsx("h4",{children:"Bénéfice Net Total"}),a.jsxs("p",{className:"summary-value",children:["€",t.annualTotals.totalProfit.toFixed(2)]})]})]})]}),a.jsxs("div",{className:"monthly-breakdown",children:[a.jsx("h3",{children:"Détail Mensuel"}),a.jsxs("div",{className:"monthly-table",children:[a.jsxs("div",{className:"table-header",children:[a.jsx("div",{className:"table-cell",children:"Mois"}),a.jsx("div",{className:"table-cell",children:"CA (€)"}),a.jsx("div",{className:"table-cell",children:"Charges (€)"}),a.jsx("div",{className:"table-cell",children:"Commissions (€)"}),a.jsx("div",{className:"table-cell",children:"Bénéfice (€)"})]}),t.monthlyProfits.map((e,s)=>a.jsxs("div",{className:"table-row",children:[a.jsx("div",{className:"table-cell month-cell",children:e.month}),a.jsx("div",{className:"table-cell",children:e.turnover.toFixed(2)}),a.jsx("div",{className:"table-cell",children:e.expenses.toFixed(2)}),a.jsx("div",{className:"table-cell",children:e.commissions.toFixed(2)}),a.jsx("div",{className:"table-cell profit-cell "+(e.profit>=0?"positive":"negative"),children:e.profit.toFixed(2)})]},s))]})]})]})]})]})}):null},S=()=>{const{user:n,logout:t}=l(),[r,i]=e.useState(null),[c,o]=e.useState([]),[d,m]=e.useState(!0),[h,u]=e.useState(""),[p,x]=e.useState(!1),[j,S]=e.useState(null),[E,F]=e.useState(!1),[D,A]=e.useState(!1),[$,_]=e.useState(!1),[P,R]=e.useState(!1),[q,T]=e.useState(!1),[M,O]=e.useState(!1),[L,I]=e.useState(!1),U=e.useRef(null),B="http://localhost:3001/api/v1",G=e.useRef(null),H=e.useCallback(async()=>{try{console.log("AdminDashboard - Fetching dashboard data from:",`${B}/dashboard`);const e=await s.get(`${B}/dashboard`);console.log("AdminDashboard - Dashboard data fetched:",e.data),i(e.data);const a=await s.get(`${B}/employees`);console.log("AdminDashboard - Employees data fetched:",a.data),o(a.data.data||[])}catch(e){console.error("AdminDashboard - Failed to fetch dashboard data:",e),u("Failed to load dashboard data")}finally{m(!1)}},[B]);e.useEffect(()=>{if(console.log("AdminDashboard - User data:",n),H(),n&&n.id){const e="http://localhost:3001";return G.current=v(e),G.current.emit("join-dashboard",n.id),G.current.on("dashboard-data-updated",()=>{console.log("AdminDashboard - Real-time update received, refreshing data"),H()}),()=>{G.current&&G.current.disconnect()}}},[n,H]),e.useEffect(()=>{const e=e=>{U.current&&!U.current.contains(e.target)&&I(!1)};return L&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[L]);const V=()=>{console.log("AdminDashboard - Logout clicked"),t()},Z=e=>{switch(I(!1),e){case"dashboard":break;case"createEmployee":x(!0);break;case"manageEmployees":T(!0);break;case"managePackages":A(!0);break;case"expenses":_(!0);break;case"statistics":R(!0);break;case"annualProfit":O(!0)}},J=e=>{S(e),F(!0)};return d?a.jsxs("div",{className:"loading-container",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"Loading dashboard..."})]}):h?a.jsxs("div",{className:"dashboard-container",children:[a.jsx("div",{className:"error-message",children:h}),a.jsx("button",{onClick:V,className:"logout-button",children:"Logout"})]}):a.jsxs("div",{className:"dashboard-container",children:[a.jsxs("header",{className:"dashboard-header",children:[a.jsx("h1",{children:"Admin Dashboard"}),a.jsxs("div",{className:"user-info",children:[a.jsxs("span",{children:["Welcome, ",n?.name||n?.email]}),a.jsx("button",{onClick:()=>{I(!L)},className:"hamburger-btn",children:"☰"})]})]}),L&&a.jsxs("div",{className:"hamburger-menu",ref:U,children:[a.jsx("button",{onClick:()=>Z("dashboard"),className:"menu-item",children:"Dashboard Admin"}),a.jsx("button",{onClick:()=>Z("createEmployee"),className:"menu-item",children:"Créer Employé"}),a.jsx("button",{onClick:()=>Z("manageEmployees"),className:"menu-item",children:"Gestion des Employés"}),a.jsx("button",{onClick:()=>Z("managePackages"),className:"menu-item",children:"Gestion des Forfaits"}),a.jsx("button",{onClick:()=>Z("expenses"),className:"menu-item",children:"Charges"}),a.jsx("button",{onClick:()=>Z("statistics"),className:"menu-item",children:"Statistiques"}),a.jsx("button",{onClick:()=>Z("annualProfit"),className:"menu-item",children:"Bénéfices Annuels"}),a.jsx("div",{className:"menu-divider"}),a.jsx("button",{onClick:V,className:"menu-item logout-item",children:"Déconnexion"})]}),a.jsxs("div",{className:"dashboard-content",children:[r&&r.data?a.jsxs("div",{className:"dashboard-stats",children:[a.jsxs("div",{className:"stat-card",children:[a.jsx("h3",{children:"Chiffre d'Affaires"}),a.jsxs("p",{className:"stat-value",children:["€",r.data.summary?.turnover||0]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("h3",{children:"Bénéfice"}),a.jsxs("p",{className:"stat-value",children:["€",r.data.summary?.profit||0]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("h3",{children:"Employés"}),a.jsx("p",{className:"stat-value",children:r.data.summary?.employeeCount||0})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("h3",{children:"Forfaits Actifs"}),a.jsx("p",{className:"stat-value",children:r.data.summary?.packageCount||0})]})]}):a.jsx("div",{className:"no-data",children:a.jsx("p",{children:"Aucune donnée disponible"})}),a.jsxs("div",{className:"employees-section",children:[a.jsx("h2",{children:"Équipe"}),c.length>0?a.jsx("div",{className:"employees-grid",children:c.map(e=>a.jsx(N,{employee:e,onCardClick:J},e.id))}):a.jsxs("div",{className:"no-employees",children:[a.jsx("p",{children:"Aucun employé enregistré"}),a.jsx("button",{onClick:()=>x(!0),className:"create-employee-button",children:"Créer le premier employé"})]})]})]}),a.jsx(g,{isOpen:p,onClose:()=>x(!1),onEmployeeCreated:e=>{o(a=>[...a,e]),H()}}),a.jsx(b,{isOpen:E,onClose:()=>F(!1),employee:j}),a.jsx(C,{isOpen:D,onClose:()=>A(!1)}),a.jsx(f,{isOpen:$,onClose:()=>_(!1)}),a.jsx(k,{isOpen:P,onClose:()=>R(!1)}),a.jsx(y,{isOpen:q,onClose:()=>T(!1),onEmployeeUpdated:()=>{H()}}),a.jsx(w,{isOpen:M,onClose:()=>O(!1)})]})};export{S as default};
